</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
<script src="/select/jquery.min.js"></script>
<script src="/select/select2.min.js"></script>
<script>
     $(document).ready(function () {
    // getting symptoms from backend
    $.get('/symptoms', function (data) {
        const symptomsFormatted = data.map(symptom => ({ id: symptom.ID, text: symptom.Name }));

        // Initialize Select2
        $('#Symptoms').select2({
            data: symptomsFormatted,
            placeholder: 'Search and select symptoms',
            multiple: true,
            allowClear: true,
        });
    });

    // Handle form submission
    $("#diseaseForm").submit(function (event) {
        event.preventDefault(); 

        const selectedSymptoms = $("#Symptoms").val() || [];
        console.log("Selected Symptoms:", selectedSymptoms);

        const gender = $("#Gender").val();
        console.log(gender);
        const age = $("#age").val();
        console.log(age);

        $.ajax({
            type: 'POST',
            url: '/predict-disease',
            data: {
                symptoms: selectedSymptoms,
                gender: gender,
                yearOfBirth: age
            },
            dataType: 'json', 
            success: function (response) {
            console.log("Server response:", response);

            //to show result 
            const resultContainer = $('#resultContainer');
            resultContainer.empty();
            
            if (response.diseases && response.diseases.length > 0) {
            resultContainer.append('<h2 class="mt-4 p-2">Diagnosis Result:</h2>');
            const listGroup = $('<ol class="list-group list-group-numbered"></ol>');

            response.diseases.forEach((disease) => {
                listGroup.append(`<li class="list-group-item">${disease}</li>`);
            });
            // Append the constructed list to the result container
            resultContainer.append(listGroup);
        }},
            error: function(error) {
                console.error("Error:", error);
                $('#resultContainer').html('<p>Error fetching diseases. Please try again.</p>');
            }
        });
    });
});
</script>
</body>
</html>